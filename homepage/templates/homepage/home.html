{% extends "layout.html" %}
{% load static %}
{% block head %}
	<title>Read the Kaguya-sama manga series | Guya.moe</title>
	<meta name="twitter:description" content="Read the Kaguya-sama: Love is War / Kaguya Wants to Be Confessed To manga and spin-off series. No ads. No bad reader. All guya." />
	<meta property="og:description" content="Read the Kaguya-sama: Love is War / Kaguya Wants to Be Confessed To manga and spin-off series. No ads. No bad reader. All guya." />
	<meta name="description" content="Read the Kaguya-sama: Love is War / Kaguya Wants to Be Confessed To manga and spin-off series. No ads. No bad reader. All guya.">
	<meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Read the Kaguya-sama manga series | Guya.moe" />
    <meta name="twitter:image" content="https://i.imgur.com/jBhT5LV.png" />
    <meta property="og:image" content="https://i.imgur.com/jBhT5LV.png">
    <meta property="og:url" content="/">
	<style>
	* {
		border: 0px solid red;
	}

	a:hover {
		text-decoration: none;
	}

	.img {
		height: auto;
		/* width: 20vw; */
		margin-bottom: 5vh;
		transition: 0.2s ease-in-out;
	}

	.img:hover {
		transform: scale(1.1, 1.1);
		opacity: 0.8;
		/* box-shadow: 0 12px 16px 0 rgba(0, 0, 0, 0.24), 0 17px 50px 0 rgba(0, 0, 0, 0.19); */
	}

	.sp-button {
		padding: 5%;
		background-color: #4b4b4b;
		color: white;
		transition: 0.2s ease-in-out;
	}

	.sp-button:hover {
		background-color: #e72e8c;
		transform: scale(1.1, 1.1);
		box-shadow: 0 12px 16px 0 rgba(0, 0, 0, 0.24), 0 17px 50px 0 rgba(0, 0, 0, 0.19);
	}

	.sp-button:focus {
		outline:0;
	}

	.sp-row-add {
		margin: 0;
	}

	.caption {
		margin-top: 2vh;
		word-wrap: wrap break-word;
	}

	img>p {
		width: inherit
	}

	.manga [class*="col-xs"] {
		margin-bottom: 15px;
	}
	body.h-100 {
		min-height: 100%;
		height: auto !important;
	}
	.manga h3 {
		color: #ddd;
		font-size: 1.5em;
		padding: 0 0.5em;
	}
		
	.tachi {
		margin-bottom: 3em;
		margin-right: 0;
		margin-left: 0;
	}

	.tachi > div {
		width: 100%;
	}

	.tachi img {
		height: 33px;
	}

	.tachi-plus {
		font-size: 1.5em;
		padding: 0 0.6em 0 0.4em;
	}

	.tachi .ecks {
		display: none;
	}

	@media only screen and (max-width: 760px) {
		.tachi {
			position: fixed;
			bottom: 0;
			width: 100%;
			bottom: 0;
			z-index: 1000;
			background: #232323;
			margin: 0;
			left: 0;
			padding: 1em 0 1.5em;
			border-top: 2px #777 solid;
		}

		.tachi > div.mb-5 {
			margin-bottom: 0 !important;
		}

		.tachi .ecks {
			display: block;
			position: absolute;
			font-size: 2em;
			color: white;
			padding: 0.25em 0.25em;
			box-sizing: content-box;
			width: 1em;
			line-height: 1em;
			height: 1em;
			right: 0;
			top: 0;
			cursor: pointer;
		}

	}

	#quote:hover {
		transform: scale(1.1);
		border: 1px solid #3A3F44;
	}
</style>

{% endblock %}

{% block body %}
<main role="main"> 
	<div class="manga-card" style="background-image: url(/static/img/bg_box_blur_smol.png);">
		<a class="picture" href="/read/manga/Kaguya-Wants-To-Be-Confessed-To/"><picture>
			<source type="image/webp" srcset="{{ main_cover_webp }}" class="" alt="Kaguya-sama: Love is War">
  			<img src="{{ main_cover }}" class="" alt="Kaguya-sama: Love is War">
		</picture></a>
		<article>
			<a href="/read/manga/Kaguya-Wants-To-Be-Confessed-To/"><h1>Kaguya-sama: Love is War</h1></a>
			<h2>Kaguya-sama Wants to Be Confessed To: The Geniuses' War of Love and Brains</h2>
			<h2>Kaguya-sama wa Kokurasetai: Tensai-tachi no Renai Zunousen</h2>
			<div class="manga-links">
				<span>
					<a href="/read/manga/Kaguya-Wants-To-Be-Confessed-To/" class="manga-link full guya">Read the manga ›</a>
				</span>
				<span>
					<a href="#chapter_listing_exp" onclick="
						document.getElementById('chapter_listing').classList.add('vis');
						document.getElementById('chapter_listing_exp').classList.add('vis');
					" class="manga-link after-anime">Where to start after the anime ›</a><a href="//tachiyomi.org/extensions/#Guya" class="manga-link tachiyom">Tachiyomi plugin</a>
				</span>
			</div>
			<p>All’s fair when love is war!</p>
			<p>Two geniuses. Two brains. Two hearts. One battle.</p>
			<p>Kaguya Shinomiya and Miyuki Shirogane are the geniuses leading their prestigious academy’s student council, and inevitably they fell for each other. But they both are too prideful to be the first to confess, as that would be a loss in the competition of love! In the end, who will confess their love first?</p>
			<p class="yeet">I like to call this the Death Note of school romantic comedies. If Death Note ever made you laugh out loud (on purpose).</p>
			<div class="manga-links shill">
				<span>
					<a rel="noreferrer nofollow" href="https://www.viz.com/read/manga/kaguya-sama-love-is-war/all" class="manga-link viz">VIZ Media</a>
					<a rel="noreferrer nofollow" href="https://www.amazon.com/gp/bookseries/B0778N11ZV" class="manga-link ama">Amazon</a>
					<a rel="noreferrer nofollow" href="https://play.google.com/store/books/series?id=Cv3xGgAAABD65M&hl=en_US" class="manga-link gp">Google Play</a>
					<a rel="noreferrer nofollow" href="https://apps.qoo-app.com/en/app/6233" class="manga-link yj jp">Young Jump Weekly</a>
					<a rel="noreferrer nofollow" href="http://books.shueisha.co.jp/search/search.html?order=1&seriesid=37405" class="manga-link shu jp">Shueisha</a>
				</span>
			</div>
		</article>
		<div  id="chapter_listing_exp" class="chapter-listing-expander" onmousedown="
			event.stopImmediatePropagation();
			document.getElementById('chapter_listing').classList.toggle('vis');
			event.currentTarget.classList.toggle('vis');
		"><span>List of chapters</span></div>
		<table id="chapter_listing" class="chapter-listing hidden">
		</table>
	</div>
	<a href="/read/manga/We-Want-To-Talk-About-Kaguya/" class="manga-card smol" style="background-image: url({{ 4koma_cover_blur }})">
		<picture>
			<source type="image/webp" srcset="{{ 4koma_cover_webp }}" class="" alt="We Want to Talk About Kaguya">
  			<img src="{{ 4koma_cover }}" class="" alt="We Want to Talk About Kaguya">
		</picture>
		<article>
			<h2>We Want to Talk About Kaguya <span class="tag">Spin-off</span></h2>
			<p>A comedic tale of two delusional girls who have absolutely no idea what goes on in the Student Council room!</p>
		</article>
	</a>
	<a href="/read/manga/Kaguya-Wants-To-Be-Confessed-To-Official-Doujin/" class="manga-card smol" style="background-image: url({{ doujin_cover_blur }})">
		<picture>
			<source type="image/webp" srcset="{{ doujin_cover_webp }}" class="" alt="Kaguya Wants to Be Confessed To: Official Doujin">
  			<img src="{{ doujin_cover }}" class="" alt="Kaguya Wants to Be Confessed To: Official Doujin">
		</picture>
		<article>
			<h2>Kaguya Wants to Be Confessed To: Official Doujin <span class="tag">Spin-off</span></h2>
			<p>Official non-canon spin-off that contains stories featuring characters from the main manga in lewd and foreign settings.</p>
		</article>
	</a>
	<a href="//skythewood.blogspot.com/p/kaguya.html" target="_blank" class="manga-card smol" style="background-image: url({% static 'img/novelcover_blur.jpg' %})">
		<picture>
  			<img src="{% static 'img/novelcover.jpg' %}" class="" alt="Novel: The Seven Mysteries of Shuchiin Academy">
		</picture>
		<article>
			<h2>Novel: The Seven Mysteries of Shuchiin Academy <span class="tag">Spin-off</span></h2>
			<p>A light novel side story about the paranormal Legend of the Seven Mysteries of Shuchiin that the Student Council suddenly gets drawn into.</p>
		</article>
	</a>
	<a href="//kaguya-archive.tumblr.com/" target="_blank" class="manga-card smol" style="background-image: url({% static 'img/fanmade_media_blur.png' %})">
		<picture>
  			<img src="{% static 'img/fanmade_media.png' %}" class="" alt="Fanmade Media">
		</picture>
		<article>
			<h2>Fanmade Media</h2>
			<p>The archive website that contains translations and links to most of the fanmade media that is being produced on our Discord or elsewhere.</p>
		</article>
	</a>
</main>
</main>
<footer class="container-fluid footer mt-auto">
	<div class="row justify-content-between small" style="background-color:#2a2a2a;">
		<div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 float-left">
		</div>
		<div id="quote-block" class="col-lg-8 col-md-8 col-sm-8 col-xs-8 text-center">
		</div>
		<div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 float-right">
			<img id="twintail-guya" class="img-fluid mx-auto d-block" style="height: 75px; width: 56px; float:right"
				src="{% static 'img/img_comics-bottom.png' %}">
		</div>
	</div>
	<!-- <a href="#" onclick="setTimeout(function () {  localStorage.setItem('reload', '1') }, 1);">reload stop</a><a href="#" onclick="setTimeout(function () {  localStorage.setItem('reload', '0')}, 1);">| start</a> -->
</footer>

<script>
	let quoteNumb = Math.floor(Math.random() * 9) + 1;
	document.getElementById("quote-block").innerHTML = `<a target="_blank" href="//discord.gg/4WPqwSY"><img id="quote" class="img-fluid mx-auto d-block" src="{% static 'img/' %}quote${quoteNumb}.png" style="max-height: 70px"></a>`;

	let msd = {{ main_series_data|safe }};

	var chapterList = doT.template(`
		<tbody>
		<tr class="chapter-row header">
			<th class="chapter-n"></th>
			<th class="chapter-name">Title</th>
			<th class="chapter-date" onclick="chapter_listing.children[1].reverseChildren(); event.target.classList.toggle('desc')">Upload date</th>
		</tr>
		</tbody>
		<tbody>
		((~it :value:index))
		<tr class="chapter-row ((? window.adapted.has(value[3]) ))adapted((?))((? +value[3] in s2_anime_map )) s2((?))">
			<td class="chapter-n">((=value[1]))</td>
			<td class="chapter-name"><a href="/read/manga/Kaguya-Wants-To-Be-Confessed-To/((=value[3]))/1">((=value[2]))</a>((? window.adapted.has(value[3]) ))<span data-anime="((=getAnimeString(+value[3]) ))">((? +value[3] in s2_anime_map ))Season 2!((??))Adapted((?))</span>((?))</td>
			<td class="chapter-date">((= value[5][0] ))-((= zpad(1+value[5][1]) ))-((= zpad(value[5][2]) ))</td>
		</tr>
		((~))
		<tbody>
		`)

var chaps_asc = msd.chapter_list.reverse();

	// Map goes from {chapter: [episode (1-indexed), part (0-indexed)]}
	s1_anime_map = {1:[1,0],5:[1,2],6:[2,2],7:[2,1],8:[3,1],9:[3,2],11:[2,0],12:[1,1],14:[3,0],16:[5,0],17:[4,0],18:[4,1],19:[4,2],20:[4,3],21:[5,2],23:[5,1],24:[6,0],25:[6,2],26:[7,0],27:[7,2],28:[6,1],29:[7,1],31:[8,1],33:[9,0],34:[9,1],35:[9,2],37:[10,0],38:[10,1],39:[8,0],40:[10,2],41:[11,2],42:[11,0],43:[11,1],44:[12,0],45:[12,1],46:[12,2],55:[8,2]}
	s2_anime_map = {30:[1,0],36:[5,2],48:[1,1],51:[1,3],52:[2,0],53:[2,1],54:[2,2],56:[3,0],57:[1,2],58:[4,0],59:[3,1],60:[3,2],61:[4,1],63:[5,0],64:[5,1],65:[4,2],66:[5,3],67:[6,0],68:[6,1],69:[6,2],81:[],88:[]};
	adapted = new Set([...Object.keys(s1_anime_map), ...Object.keys(s2_anime_map)]);
	chapter_listing.innerHTML = chapterList(chaps_asc);

	function getAnimeString(num) {
		let map, season;
		if (num in s1_anime_map) {
			map = s1_anime_map;
			season = 1;
		} else if (num in s2_anime_map) {
			map = s2_anime_map;
			season = 2;
		} else {
			throw new Error("Map error, this shouldn't be thrown.");
		}
		let episode = map[num][0] || "TBA";
		let part = 1 + map[num][1] || "TBA";
		return `Season ${season}, Episode ${episode}, part ${part}`;
	}

	function zpad(n){
		if(n < 10) return '0'+n;
		return n;
	}
</script>

<!-- History script -->
<!-- This badly needs linting but I can't be assed. -->
<script>

let MAX_CLICKS = 7;

let refreshProxyElements = () => {
	document.querySelectorAll(".proxy").forEach(e => e.remove());
	proxyInitElements();
}

let deleteItem = async (event, element, source, slug) => {
	event.preventDefault();
	await globalHistoryHandler.removeSeries(slug, source);
	element.parentElement.parentElement.parentElement.remove();
};

let pinItem = async (event, element, source, slug) => {
	event.preventDefault();
	await globalHistoryHandler.pinSeries(slug, source);
	refreshProxyElements();
};

let proxyDestroyElements = () => {
	document.querySelectorAll(".proxy").forEach(e => e.remove());
	document.getElementById("rs-widget").remove();
}

let proxyInitElements = async () => {
	let firstUse = true;
	let mangaAppender = (item, pinned) => {
		if (item.url && item.coverUrl && item.title && item.source && item.slug) {
			document.querySelector("[role='main']").insertAdjacentHTML(
				"beforeend",
				`<a href="${item.url}" class="manga-card smol proxy" style="background-image: url('${item.coverUrl}')">
				<picture>
					<img src="${item.coverUrl}">
				</picture>
				<article>
					<h2>${item.title} <span class="tag">${item.source.replace("_", " ")}</span> <i class="fa fa-trash" onclick="deleteItem(event, this, '${item.source}', '${item.slug}');">${pinned ? "" : `</i> <i class="fa fa-heart" onclick="pinItem(event, this, '${item.source}', '${item.slug}');">`}</i></h2>
				</article>
				</a>`
			);
		}
	};
	let pinnedSeries = (await globalHistoryHandler.getAllPinnedSeries()).filter(e => e.source !== "default");
	if (pinnedSeries.length) {
		firstUse = false;
		document
			.querySelector("[role='main']")
			.insertAdjacentHTML(
				"beforeend",
				"<h3 class='proxy' style='width:100%; padding-left:1rem;'>Proxy Favourites</h3>"
			);
		pinnedSeries.forEach((item) => mangaAppender(item, true));
	}
	let unpinnedSeries = await globalHistoryHandler.getAllUnpinnedSeries();
	if (unpinnedSeries.length) {
		firstUse = false;
		document
			.querySelector("[role='main']")
			.insertAdjacentHTML(
				"beforeend",
				"<h3 class='proxy' style='width:100%; padding-left:1rem;'>Proxy History</h3>"
			);
		unpinnedSeries.forEach((item) => mangaAppender(item));
	}

  	if (firstUse) {
		document.querySelector("[role='main']").insertAdjacentHTML(
			"beforeend",
			`<div class="manga-card proxy" style="width:100%">
				<article>
					<p>Looks like you haven't used the proxy yet! This card will give you a short tutorial about how it works.</p>
					<p>Note that your history is unique to you, and won't be shared with guya.moe.</p>
					<br>
					<h4>MangaDex</h4>
					<p>Replace <code>mangadex.org</code> in the URL with <code>guya.moe</code>. For example, <code>https://mangadex.org/title/17274/</code> becomes <code>https://guya.moe/title/17274/</code>.</p>
					<br>
					<h4>NHentai</h4>
					<p>Replace <code>nhentai.net</code> in the URL with <code>guya.moe</code>. For example, <code>https://nhentai.net/g/1/</code> becomes <code>https://guya.moe/g/1/</code>.</p>
					<br>
					<h4>FoolSlide Sites</h4>
					<p>Append the FoolSlide site's URL to the end of <code>https://guya.moe/fs/</code>. For example, <code>https://jaiminisbox.com/reader/series/kaguya-wants-to-be-confessed-to</code> becomes <code>https://guya.moe/fs/https://jaiminisbox.com/reader/series/kaguya-wants-to-be-confessed-to</code>.</p>
					<p>Some FoolSlide enabled sites include:</p>
					<ul>
					<li><code>https://hentai.cafe/</code></li>
					<li><code>https://jaiminisbox.com/</code></li>
					<li><code>https://helveticascans.com/</code></li>
					</ul>
					<p>Once you start reading, this card will disappear and this section will fill up with your last <strong>${globalHistoryHandler.max}</strong> series.</p>
					<p>You can manually remove a series from your history by clicking on the <i class="fa fa-trash"></i> next to the title, or alternatively pin it with the <i class="fa fa-heart"></i> icon.</p>
					<p>You can also disable/enable this history feature at any time by clicking on the twintail Kaguya ${MAX_CLICKS + 1} times. Note that it'll clear ALL your read history every time.</p>
					<br>
					<h4>Advanced Features</h4>
					<p>You can now synchronize your reading history and favourites across different devices. This is done using a third party service which <i>you</i> control.</p>
					<p>To get started, create an account with any <code>remotestorage</code> provider. We recommend <code><a href="https://5apps.com/storage">5apps</a></code> since it's free.</p>
					<p>Once you've created an account, use your <code>user@provider.com</code> (eg. <code>guya@5apps.com</code>) account to log in using the <code>remotestorage</code> icon in the navbar. Then you're ready!</p>
					<br>
					<br>
					<p><i>Got a suggestion on how we could improve this feature? Use the feedback box with the envelope symbol on your top left!</i></p>
				</article>
			</div>`
		);
	}
};

window.addEventListener("load", () => {
	let enabled = globalHistoryHandler.enabled();
	let clicked = 0;
	document.getElementById("twintail-guya").addEventListener("click", (e) => {
		if (clicked < MAX_CLICKS) {
		clicked++;
		(e.target || e.srcElement).style.opacity = `${1 - clicked / 10}`;
		} else {
		(e.target || e.srcElement).style.opacity = "1";
		clicked = 0;
		if (enabled) {
			globalHistoryHandler.toggle.disable();
			location.reload();
		} else {
			globalHistoryHandler.toggle.enable();
			location.reload();
		}
		enabled = !enabled;
		}
	});
	if (enabled) {
		proxyInitElements();
	}
});
</script>
<script>
// Expand the series listing if requested
window.addEventListener("load", () => {
	if(window.location.hash == '#chapter_listing_exp') {
		document.getElementById('chapter_listing').classList.add('vis');
		document.getElementById('chapter_listing_exp').classList.add('vis');
	}
});
</script>
{% endblock %}
